extends layout

block content
  .profile-container
    .user-info-banner
      img(src='/images/default.jpg', alt='Photo de profil', class='profile-avatar')
      span Nom d'utilisateur : #{user.NomUtilisateur} | Nombre de jeux possédés : #{user.NombreJeux}

    script.
      function toggleEdit(sectionId) {
        const section = document.getElementById(sectionId);
        section.style.display = section.style.display === 'none' ? 'block' : 'none';
      }

    .profile-actions
      form(action='/profile/edit-name', method='POST')
        button.red-btn(type='button', onclick="toggleEdit('edit-name')") Changer mon nom d'utilisateur

        #edit-name(style='display:none;')
          input(type='text', name='newName', placeholder='Nouveau nom d\'utilisateur', required)
          button.red-btn(type='submit') Valider le changement

      form(action='/profile/edit-password', method='POST')
        button.yellow-btn(type='button', onclick="toggleEdit('edit-password')") Changer mon mot de passe

        #edit-password(style='display:none;')
          input(type='password', name='newPassword', placeholder='Nouveau mot de passe', required)
          button.yellow-btn(type='submit') Valider le changement

      form(action='/logout', method='POST', style='display:inline')
        button(type='submit' class='default-btn') Se déconnecter

      form(action='/profile/delete', method='POST', onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible.')")
        button.blue-btn(type='submit') Supprimer mon compte

    .section
      h2 Wishlist
      if wishlist.length
        .wishlist-slider
          button.left-button ◀
          .wishlist-track
            each jeu in wishlist
              .wishlist-card
                img(src=jeu.Image, alt=jeu.NomJeu)
                p= jeu.NomJeu
                form(action="/profile/wishlist/delete", method="POST")
                  input(type="hidden", name="IDJeu", value=jeu.IDJeu)
                  button(type="submit") 🗑️
          button.right-button ▶
      else
        p Aucune wishlist

    .section
      h2 Jeux Possédés
      if jeux.length
        ul
          each jeu in jeux
            strong #{jeu.NomJeu}
              #{jeu.Image}
      else
        p Aucun jeu possédé

    .section
      h2 Playlists
      form(action='/profile/add-playlist', method='GET')
        button(class='default-btn') Ajouter une playlist
      if playlists.length
        ul
          each p in playlists
            li strong #{p.NomJeu}
              #{p.Image}
      else
        p Aucune playlist enregistrée

    if user.IsAdmin
      .section
        h2 Gérer les accès des utilisateurs
        if utilisateurs.length
          table
            thead
              tr
                th Nom d'utilisateur
                th Admin
                th Actions
            tbody
              each u in utilisateurs
                tr
                  td #{u.NomUtilisateur}
                  td #{u.IsAdmin ? 'Oui' : 'Non'}
                  td
                    if !u.IsAdmin
                      form(action='/profile/admin/make-admin', method='POST', style='display:inline')
                        input(type='hidden', name='userId', value=u.IDUtilisateur)
                        button(type='submit') Rendre admin
                    else
                      form(action='/profile/admin/remove-admin', method='POST', style='display:inline')
                        input(type='hidden', name='userId', value=u.IDUtilisateur)
                        button(type='submit') Retirer admin
        else
          p Aucun utilisateur trouvé
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const track = document.querySelector('.wishlist-track');
      const leftBtn = document.querySelector('.left-button');
      const rightBtn = document.querySelector('.right-button');

      let scrollAmount = 0;
      const scrollStep = 300;

      leftBtn.addEventListener('click', () => {
        scrollAmount -= scrollStep;
        if (scrollAmount < 0) scrollAmount = 0;
        track.scrollTo({ left: scrollAmount, behavior: 'smooth' });
      });

      rightBtn.addEventListener('click', () => {
        scrollAmount += scrollStep;
        track.scrollTo({ left: scrollAmount, behavior: 'smooth' });
      });
    });
